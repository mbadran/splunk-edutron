"use client";

import { useAtom } from "jotai";
import { useEffect } from "react";
import HomePage from "@/components/HomePage";
import { APP_NAME } from "@/utils/constants";
import { catalogsAtom, catalogsLoadingAtom, setWorkingAtom } from "@/atoms/globalAtoms";
import { loadAllCatalogs } from "@/utils/catalogLoader";

// Force static generation
export const dynamic = "force-static";

export default function Home() {
  const [catalogs, setCatalogs] = useAtom(catalogsAtom);
  const [catalogsLoading, setCatalogsLoading] = useAtom(catalogsLoadingAtom);
  const [, setWorking] = useAtom(setWorkingAtom);

  // Initialize app and load catalogs
  useEffect(() => {
    document.title = `${APP_NAME} - Training Plans for Splunky Teams`;
    
    // Load catalogs on app initialization if not already loaded or loading
    if (catalogs.length === 0 && !catalogsLoading) {
      loadCatalogs();
    }
  }, []);

  const loadCatalogs = async () => {
    setCatalogsLoading(true);
    setWorking({ isWorking: true, message: "Initializing catalogs..." });

    try {
      const loadedCatalogs = await loadAllCatalogs();
      setCatalogs(loadedCatalogs);
    } catch (error) {
      console.error("Failed to initialize catalogs:", error);
      // Don't show error on initial load, just log it
    } finally {
      setCatalogsLoading(false);
      setWorking({ isWorking: false, message: "" });
    }
  };

  return (
    <div id="homepage">
      <HomePage />
    </div>
  );
}